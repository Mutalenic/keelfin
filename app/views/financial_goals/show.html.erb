<nav class="flex justify-center align-center space-x-4 bg-[#3778c2] text-white">
  <ul class="w-full flex flex-row justify-between align-center p-5">
    <li>
      <%= link_to '', financial_goals_path, class: "text-xl fa-solid fa-arrow-left" %>
    </li>
    <li>
      <h1 class="text-xl uppercase">Goal Details</h1>
    </li>
    <li>
      <%= link_to '', edit_financial_goal_path(@financial_goal), class: "text-xl fa-solid fa-pencil" %>
    </li>
  </ul>
</nav>

<div class="container mx-auto px-4 py-6">
  <!-- Goal Header -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <div class="flex justify-between items-start">
      <div>
        <h1 class="text-2xl font-bold mb-2"><%= @financial_goal.name %></h1>
        <p class="text-gray-600"><%= @financial_goal.description %></p>
        <div class="mt-3 flex flex-wrap gap-2">
          <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
            <%= @financial_goal.goal_type.humanize %>
          </span>
          <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold 
            <%= case @financial_goal.priority
                when 'high' then 'bg-red-100 text-red-800'
                when 'medium' then 'bg-yellow-100 text-yellow-800'
                else 'bg-green-100 text-green-800'
                end %>">
            <%= @financial_goal.priority.capitalize %> Priority
          </span>
          <% if @financial_goal.recurring %>
            <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold bg-purple-100 text-purple-800">
              Recurring: <%= @financial_goal.recurrence_period %>
            </span>
          <% end %>
          <% if @financial_goal.category %>
            <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold bg-gray-100 text-gray-800">
              <%= @financial_goal.category.name %>
            </span>
          <% end %>
        </div>
      </div>
      <div class="text-right">
        <% if @financial_goal.completed? %>
          <span class="inline-block px-4 py-2 rounded-lg text-sm font-bold bg-green-100 text-green-800">
            Completed
          </span>
        <% elsif @financial_goal.target_date < Date.current %>
          <span class="inline-block px-4 py-2 rounded-lg text-sm font-bold bg-red-100 text-red-800">
            Overdue
          </span>
        <% else %>
          <span class="inline-block px-4 py-2 rounded-lg text-sm font-bold bg-blue-100 text-blue-800">
            Active
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Progress Section -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Progress</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-600 mb-1">Current Amount</p>
        <p class="text-2xl font-bold">K<%= number_with_precision(@financial_goal.current_amount, precision: 2) %></p>
      </div>
      
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-600 mb-1">Target Amount</p>
        <p class="text-2xl font-bold">K<%= number_with_precision(@financial_goal.target_amount, precision: 2) %></p>
      </div>
      
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-600 mb-1">Remaining</p>
        <p class="text-2xl font-bold">K<%= number_with_precision(@financial_goal.target_amount - @financial_goal.current_amount, precision: 2) %></p>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mb-2">
      <div class="flex justify-between text-sm mb-1">
        <span>Progress: <%= @financial_goal.progress_percentage %>%</span>
        <span><%= @financial_goal.days_remaining %> days remaining</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-4">
        <div class="bg-blue-600 h-4 rounded-full" style="width: <%= @financial_goal.progress_percentage %>%"></div>
      </div>
    </div>
    
    <!-- Daily Target -->
    <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <div class="flex items-center">
        <div class="mr-4 text-blue-500">
          <i class="fa-solid fa-calendar-day text-2xl"></i>
        </div>
        <div>
          <p class="font-medium">Daily Target</p>
          <p class="text-sm">You need to save <strong>K<%= number_with_precision(@financial_goal.daily_target, precision: 2) %></strong> per day to reach your goal on time.</p>
        </div>
      </div>
    </div>
    
    <!-- Update Progress Form -->
    <% unless @financial_goal.completed? %>
      <div class="mt-6">
        <%= form_with url: update_progress_financial_goal_path(@financial_goal), method: :patch, class: "flex items-center space-x-4" do |f| %>
          <div class="flex-grow">
            <%= f.label :current_amount, "Update Current Amount", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <div class="mt-1 flex rounded-md shadow-sm">
              <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500">K</span>
              <%= f.number_field :current_amount, value: @financial_goal.current_amount, step: "0.01", min: "0", class: "flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500" %>
            </div>
          </div>
          <%= f.submit "Update Progress", class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
        <% end %>
      </div>
    <% end %>
  </div>
  
  <!-- Timeline & Milestones -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Timeline & Milestones</h2>
    
    <div class="flex justify-between mb-6 text-sm">
      <div>
        <p class="text-gray-600">Start Date</p>
        <p class="font-semibold"><%= @financial_goal.start_date.strftime('%b %d, %Y') %></p>
      </div>
      <div class="text-center">
        <p class="text-gray-600">Duration</p>
        <p class="font-semibold"><%= (@financial_goal.target_date - @financial_goal.start_date).to_i %> days</p>
      </div>
      <div class="text-right">
        <p class="text-gray-600">Target Date</p>
        <p class="font-semibold"><%= @financial_goal.target_date.strftime('%b %d, %Y') %></p>
      </div>
    </div>
    
    <!-- Milestones -->
    <% if @financial_goal.milestones.present? && @financial_goal.milestones.any? %>
      <h3 class="font-medium text-lg mb-3">Milestones</h3>
      <div class="space-y-4">
        <% @financial_goal.milestones.each do |milestone| %>
          <div class="flex items-center">
            <div class="relative mr-4">
              <div class="h-full w-0.5 absolute left-2.5 bg-gray-200"></div>
              <div class="w-5 h-5 rounded-full <%= milestone['completed'] ? 'bg-green-500' : 'bg-gray-300' %> flex items-center justify-center">
                <% if milestone['completed'] %>
                  <i class="fa-solid fa-check text-white text-xs"></i>
                <% end %>
              </div>
            </div>
            <div class="flex-grow">
              <p class="font-medium"><%= milestone['name'] %></p>
              <p class="text-sm text-gray-600"><%= milestone['target_date'] %> â€¢ <%= number_with_precision(milestone['amount'], precision: 2) %></p>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 italic">No milestones set for this goal.</p>
    <% end %>
  </div>
  
  <!-- Recommendations -->
  <% if @recommendations.present? %>
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Recommendations</h2>
      
      <div class="space-y-4">
        <% @recommendations.each do |recommendation| %>
          <div class="flex items-start">
            <div class="mr-3 text-blue-500">
              <i class="fa-solid fa-lightbulb"></i>
            </div>
            <p><%= recommendation %></p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <!-- Related Transactions -->
  <% if @related_transactions&.any? %>
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Related Transactions</h2>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @related_transactions.each do |transaction| %>
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900"><%= transaction.name %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-500"><%= transaction.created_at.strftime('%b %d, %Y') %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium">K<%= number_with_precision(transaction.amount, precision: 2) %></div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
  
  <!-- Action Buttons -->
  <div class="mt-6 flex justify-between">
    <%= link_to "Back to Goals", financial_goals_path, class: "bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700" %>
    
    <div class="space-x-2">
      <%= link_to "Edit Goal", edit_financial_goal_path(@financial_goal), class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
      <%= button_to "Delete Goal", financial_goal_path(@financial_goal), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this goal?" }, class: "bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700" %>
    </div>
  </div>
</div>
