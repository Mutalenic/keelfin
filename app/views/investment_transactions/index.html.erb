<nav class="flex justify-center align-center space-x-4 bg-[#3778c2] text-white">
  <ul class="w-full flex flex-row justify-between align-center p-5">
    <li>
      <%= link_to '', investment_path(@investment), class: "text-xl fa-solid fa-arrow-left" %>
    </li>
    <li>
      <h1 class="text-xl uppercase">Investment Transactions</h1>
    </li>
    <li>
      <%= link_to '', new_investment_investment_transaction_path(@investment), class: "text-xl fa-solid fa-plus" %>
    </li>
  </ul>
</nav>

<div class="container mx-auto px-4 py-6">
  <!-- Investment Header -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="text-xl font-semibold"><%= @investment.name %></h2>
        <p class="text-gray-600"><%= @investment.investment_type_text %></p>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600">Current Value</p>
        <p class="text-2xl font-bold">K<%= number_with_precision(@investment.current_value, precision: 2) %></p>
      </div>
    </div>
  </div>

  <!-- Transaction Summary -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
      <h3 class="text-sm text-gray-600 mb-2">Total Contributions</h3>
      <p class="text-2xl font-bold text-green-600">K<%= number_with_precision(@total_contributions, precision: 2) %></p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-red-500">
      <h3 class="text-sm text-gray-600 mb-2">Total Withdrawals</h3>
      <p class="text-2xl font-bold text-red-600">K<%= number_with_precision(@total_withdrawals, precision: 2) %></p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
      <h3 class="text-sm text-gray-600 mb-2">Total Income</h3>
      <p class="text-2xl font-bold text-blue-600">K<%= number_with_precision(@total_income, precision: 2) %></p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500">
      <h3 class="text-sm text-gray-600 mb-2">Total Fees</h3>
      <p class="text-2xl font-bold text-yellow-600">K<%= number_with_precision(@total_fees, precision: 2) %></p>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h3 class="text-lg font-medium mb-4">Filter Transactions</h3>
    
    <%= form_with url: investment_investment_transactions_path(@investment), method: :get, class: "flex flex-wrap gap-4" do |f| %>
      <div class="flex-grow min-w-[200px]">
        <%= f.label :type, "Transaction Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :type, 
          [
            ['All Types', ''],
            ['Contributions', 'contribution'],
            ['Withdrawals', 'withdrawal'],
            ['Dividends', 'dividend'],
            ['Interest', 'interest'],
            ['Fees', 'fee']
          ],
          { selected: params[:type] },
          { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" }
        %>
      </div>
      
      <div class="flex-grow min-w-[200px]">
        <%= f.label :start_date, "From", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :start_date, value: params[:start_date], class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>
      
      <div class="flex-grow min-w-[200px]">
        <%= f.label :end_date, "To", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :end_date, value: params[:end_date], class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>
      
      <div class="flex items-end">
        <%= f.submit "Apply Filters", class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
        <% if params[:type].present? || params[:start_date].present? || params[:end_date].present? %>
          <%= link_to "Clear Filters", investment_investment_transactions_path(@investment), class: "ml-2 text-gray-600 hover:text-gray-800" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Transactions List -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">Transactions</h2>
      <%= link_to "Add New Transaction", new_investment_investment_transaction_path(@investment), class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
    </div>
    
    <% if @transactions.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reference</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @transactions.each do |transaction| %>
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900"><%= transaction.transaction_date.strftime('%b %d, %Y') %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                    <%= case transaction.transaction_type
                        when 'contribution' then 'bg-green-100 text-green-800'
                        when 'withdrawal' then 'bg-red-100 text-red-800'
                        when 'dividend', 'interest' then 'bg-blue-100 text-blue-800'
                        when 'fee' then 'bg-yellow-100 text-yellow-800'
                        end %>">
                    <%= transaction.transaction_type_text %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium <%= ['withdrawal', 'fee'].include?(transaction.transaction_type) ? 'text-red-600' : 'text-green-600' %>">
                    <%= ['withdrawal', 'fee'].include?(transaction.transaction_type) ? '-' : '+' %>
                    K<%= number_with_precision(transaction.amount, precision: 2) %>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900"><%= transaction.description.present? ? transaction.description : '-' %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900"><%= transaction.reference_number.present? ? transaction.reference_number : '-' %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex space-x-2 justify-end">
                    <%= link_to "Edit", edit_investment_investment_transaction_path(@investment, transaction), class: "text-indigo-600 hover:text-indigo-900" %>
                    <%= button_to "Delete", investment_investment_transaction_path(@investment, transaction), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this transaction?" }, class: "text-red-600 hover:text-red-900 bg-transparent border-none p-0 cursor-pointer" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-8 bg-gray-50 rounded-lg">
        <p class="text-gray-500 mb-4">No transactions found for this investment.</p>
        <%= link_to "Add Your First Transaction", new_investment_investment_transaction_path(@investment), class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Quick Actions -->
<div class="fixed bottom-6 right-6">
  <div class="flex flex-col space-y-2">
    <%= link_to new_investment_investment_transaction_path(@investment), class: "bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700" do %>
      <i class="fa-solid fa-plus"></i>
    <% end %>
  </div>
</div>
